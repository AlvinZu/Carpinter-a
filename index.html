<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CARPINTERIA FACIL PRO v14</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Carpinter√≠a">
    
    <link rel="icon" type="image/png" href="icon-192x192.png">
    <link rel="apple-touch-icon" href="icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180x180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png">
    <link rel="manifest" href="manifest.json">

    <style>
        :root {
            --primary: #5d4037;
            --primary-light: #8d6e63;
            --accent: #ffab00;
            --bg: #f5f5f5;
            --text: #333;
            --white: #ffffff;
            --nav-height: 65px;
            --radius: 12px;
            --tip-green-bg: #e8f5e9;
            --tip-green-border: #4caf50;
            --tip-green-text: #2e7d32;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }

        body {
            background-color: var(--bg);
            color: var(--text);
            padding-bottom: calc(var(--nav-height) + 50px);
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            padding: 1.5rem 1rem;
            padding-top: calc(1.5rem + env(safe-area-inset-top)); 
            text-align: center;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 10px rgba(93, 64, 55, 0.3);
            position: sticky; top: 0; z-index: 100;
        }
        header h1 { font-size: 1.5rem; letter-spacing: 1px; margin: 0; font-weight: 800; text-transform: uppercase; }
        header p { font-size: 0.85rem; opacity: 0.9; margin-top: 5px; }

        /* --- TABS SYSTEM --- */
        .view-section { display: none; padding: 20px 15px; animation: fadeIn 0.4s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- UI ELEMENTS --- */
        .card {
            background: var(--white); border-radius: var(--radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); padding: 20px;
            margin-bottom: 20px; border-left: 6px solid var(--accent);
        }
        h2.section-title {
            font-size: 1.2rem; color: var(--primary); margin-bottom: 20px;
            display: flex; align-items: center; gap: 10px; font-weight: 700;
        }
        .input-group { margin-bottom: 20px; position: relative; }
        .input-group label { display: block; font-size: 0.95rem; font-weight: 600; color: #555; margin-bottom: 8px; }
        .input-group input, .input-group select {
            width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 1.1rem; background: #fafafa;
        }
        .unit { position: absolute; right: 12px; top: 42px; color: #999; font-size: 0.8rem; }
        
        .btn {
            width: 100%; padding: 15px; background: var(--primary); color: white;
            border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 700;
            cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); margin-top: 10px; font-size: 0.9rem; padding: 10px;}
        
        /* Bot√≥n Guardar Peque√±o */
        .btn-save {
            background: transparent; border: 1px solid rgba(0,0,0,0.2); color: #333;
            margin-top: 15px; padding: 8px; font-size: 0.9rem; width: auto; display: inline-block;
            border-radius: 20px; padding-left: 15px; padding-right: 15px;
        }

        /* --- TABLAS --- */
        .mat-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; }
        .mat-table th { text-align: left; color: #666; border-bottom: 2px solid #eee; padding: 5px; }
        .mat-table td { padding: 8px 5px; border-bottom: 1px solid #eee; }
        .mat-summary { background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 15px; text-align: center; }
        .mat-big-num { font-size: 1.8rem; font-weight: 800; color: var(--primary); display: block; }

        /* --- ACORDE√ìN --- */
        details.accordion {
            background: white; border-radius: 8px; margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden;
        }
        details.accordion summary {
            padding: 15px; font-weight: bold; cursor: pointer; list-style: none;
            display: flex; justify-content: space-between; align-items: center;
            background: #fafafa; color: var(--primary);
        }
        details.accordion summary::after { content: '+'; font-size: 1.2rem; font-weight: bold; }
        details.accordion[open] summary::after { content: '-'; }
        details.accordion[open] summary { background: var(--accent); color: white; }
        .accordion-content { padding: 15px; border-top: 1px solid #eee; font-size: 0.95rem; line-height: 1.6; }
        .measure-item { margin-bottom: 8px; display: flex; justify-content: space-between; border-bottom: 1px dashed #eee; padding-bottom: 5px; }
        .measure-val { font-weight: bold; color: #333; }

        /* --- DESPIECE VISUAL --- */
        .diagram-box { width: 100%; height: 100px; background: #eee; margin-bottom: 15px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .d-outer { border: 2px solid #333; width: 80%; height: 80%; display:flex; justify-content:center; align-items:center; background:#ddd;}
        .d-inner { border: 2px dashed var(--accent); width: 90%; height: 90%; background: #fff; display:flex; justify-content:center; align-items:center; color: var(--accent); font-weight:bold; font-size:0.8rem;}
        
        .cut-list { 
            background: #fff8e1; border: 1px dashed var(--accent); border-radius: 8px; 
            padding: 20px; margin-top: 20px; display: none; text-align: center;
        }
        .cut-item { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 5px; text-align: left;}
        .cut-label { font-weight: 600; color: var(--primary); }
        .cut-val { font-weight: 800; color: #333; font-size: 1.1rem; }

        /* --- TIPS --- */
        .tip-card { background: white; border-radius: 12px; margin-bottom: 15px; border-top: 4px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden;}
        .tip-header { padding: 10px 15px; background-color: #efebe9; display: flex; justify-content: space-between; align-items: center; }
        .tip-tag { background: var(--primary); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; text-transform: uppercase; font-weight: bold;}
        .tip-body { padding: 15px; }
        .tip-title { color: var(--primary); margin-bottom: 8px; font-size: 1.1rem; font-weight: 700;}
        .pro-tip { background: var(--tip-green-bg); border-left: 4px solid var(--tip-green-border); color: var(--tip-green-text); padding: 12px; font-size: 0.9rem; font-style: italic; margin-top: 12px; border-radius: 0 4px 4px 0; font-weight: 500;}

        /* --- ESTILOS HISTORIAL --- */
        .history-card {
            background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center;
            border-left: 5px solid #607d8b; cursor: pointer; transition: transform 0.2s;
        }
        .history-card:active { transform: scale(0.98); background: #f9f9f9; }
        .h-info h3 { font-size: 1rem; color: #333; margin-bottom: 5px; }
        .h-info small { color: #888; font-size: 0.8rem; }
        .h-actions { display: flex; gap: 10px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; padding: 5px; cursor: pointer; color: #777; }

        /* --- MODAL --- */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center;
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); position: relative; max-height: 80vh; overflow-y: auto;
        }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; color: #aaa; cursor: pointer; font-weight: bold; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; 
            background: white; display: flex; justify-content: space-around; align-items: center;
            padding-bottom: calc(env(safe-area-inset-bottom) + 15px);
            height: calc(var(--nav-height) + env(safe-area-inset-bottom) + 15px);
            box-shadow: 0 -2px 15px rgba(0,0,0,0.05); z-index: 999;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #aaa; text-decoration: none; font-size: 0.7rem; width: 100%; height: 100%; cursor: pointer;
        }
        .nav-item.active { color: var(--primary); background: #fffbf0; border-top: 3px solid var(--primary); }
        .nav-icon { font-size: 1.4rem; margin-bottom: 3px; }
        
        .simple-result { font-weight: bold; font-size: 1.1rem; margin-top: 8px; color: #333; }

    </style>
</head>
<body>

    <header>
        <h1>Carpinter√≠a F√°cil</h1>
        <p>Herramienta Pro</p>
    </header>

    <main id="view-cut" class="view-section active">
        
        <div class="card">
            <h2 class="section-title">üì¶ Despiece de Caj√≥n</h2>
            <div class="diagram-box">
                <div class="d-outer">Mueble<div class="d-inner">Caj√≥n</div></div>
            </div>
            <p style="font-size:0.9rem; margin-bottom:15px; color:#555;">Calcula piezas respetando <b>13mm</b> de corredera por lado.</p>
            <div class="input-group"><label>Ancho INTERIOR del hueco:</label><input type="number" id="drawerHoleW" placeholder="Ej. 564"><span class="unit">mm</span></div>
            <div class="input-group"><label>Profundidad del Mueble:</label><input type="number" id="drawerDepth" placeholder="Ej. 500"><span class="unit">mm</span></div>
            <div class="input-group"><label>Grosor Melamina:</label><select id="drawerThickness"><option value="15">15 mm</option><option value="16">16 mm</option><option value="18">18 mm</option></select></div>
            <button class="btn" onclick="calcDrawer()">Calcular Cortes</button>
            <div id="resDrawer" class="cut-list" style="text-align:left;">
                <h3 style="margin-bottom:10px; color:var(--primary); text-align:center;">‚úÇÔ∏è Lista de Corte</h3>
                <div class="cut-item"><span class="cut-label">2x Laterales:</span><span class="cut-val" id="valLat"></span></div>
                <div class="cut-item"><span class="cut-label">2x Frente/Trasera:</span><span class="cut-val" id="valFront"></span></div>
                <div class="cut-item"><span class="cut-label">1x Fondo:</span><span class="cut-val" id="valFloor"></span></div>
                <span class="note" style="display:block; text-align:center; margin-top:10px;">* Corredera sugerida: <span id="valSlide" style="font-weight:bold;"></span></span>
                <div style="text-align:center;"><button class="btn-save" onclick="saveProject('Caj√≥n')">üíæ Guardar Medida</button></div>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">üö™ Puerta Interna (Inset)</h2>
            <div class="input-group"><label>Alto Hueco:</label> <input type="number" id="doorH"><span class="unit">mm</span></div>
            <div class="input-group"><label>Ancho Hueco:</label> <input type="number" id="doorW"><span class="unit">mm</span></div>
            <div class="input-group"><label>Luz por lado:</label><select id="doorGap"><option value="3">3 mm (Est√°ndar)</option><option value="2">2 mm</option></select></div>
            <button class="btn" onclick="calcDoor()">Calcular</button>
            <div id="resDoor" class="cut-list" style="background:#e0f2f1; border-color:#00897b; text-align:left;">
                <div class="cut-item"><span class="cut-label">Medida Final:</span><span class="cut-val" id="valDoorDim"></span></div>
                <span class="note" style="display:block; text-align:center;">Usar bisagras Inset (Superacodadas).</span>
                <div style="text-align:center;"><button class="btn-save" onclick="saveProject('Puerta Interna')">üíæ Guardar Medida</button></div>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">üö™ Puerta Sobrepuesta (Parche)</h2>
            <div class="diagram-box">
                <div class="d-outer" style="width:60%; height:80%; border:2px solid #ccc; position:relative;">
                    Hueco
                    <div style="position:absolute; top:-10px; left:-10px; width:calc(100% + 20px); height:calc(100% + 20px); border:2px solid var(--accent); background:rgba(255, 171, 0, 0.1); display:flex; justify-content:center; align-items:flex-end; color:var(--accent); font-weight:bold; font-size:0.8rem; padding-bottom:5px;">Puerta</div>
                </div>
            </div>
            <div class="input-group"><label>Alto Hueco (Interior):</label><input type="number" id="ovH" placeholder="Interior"><span class="unit">mm</span></div>
            <div class="input-group"><label>Ancho Hueco (Interior):</label><input type="number" id="ovW" placeholder="Interior"><span class="unit">mm</span></div>
            <div class="input-group"><label>¬øCu√°nto quieres que monte?</label><select id="ovSolape"><option value="14">14 mm (Tablero 15)</option><option value="17">17 mm (Tablero 18)</option><option value="10">10 mm (Medio parche)</option></select></div>
            <div class="input-group"><label>Cantidad de Puertas:</label><select id="ovQty"><option value="1">1 Puerta</option><option value="2">2 Puertas (Par)</option></select></div>
            <button class="btn" onclick="calcOverlayDoor()">Calcular Medida</button>
            <div id="resOverlay" class="cut-list" style="text-align:left; background:#e8f5e9; border-color:#2e7d32;">
                <h3 style="margin-bottom:10px; color:#2e7d32; text-align:center;">üìè Medida de Corte</h3>
                <div class="cut-item"><span class="cut-label">Alto:</span><span class="cut-val" id="resOvH"></span></div>
                <div class="cut-item"><span class="cut-label">Ancho (x<span id="resOvQ">1</span>):</span><span class="cut-val" id="resOvW"></span></div>
                <span class="note" style="display:block; text-align:center; margin-top:10px;">Usar bisagras Rectas o Semicurvas.</span>
                <div style="text-align:center;"><button class="btn-save" onclick="saveProject('Puerta Parche')">üíæ Guardar Medida</button></div>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">üìö Repisas / Divisiones</h2>
            <div class="diagram-box" style="flex-direction: column; justify-content: space-evenly; background: #eceff1;">
                <div style="width:70%; height:4px; background:var(--primary-light);"></div>
                <div style="width:70%; height:4px; background:var(--primary-light);"></div>
                <div style="width:70%; height:4px; background:var(--primary-light);"></div>
            </div>
            <div class="input-group"><label>Altura del Hueco (Interior):</label><input type="number" id="shelfH" placeholder="Ej. 1800"><span class="unit">mm</span></div>
            <div class="input-group"><label>Grosor de Repisa:</label><select id="shelfThick"><option value="15">15 mm</option><option value="16">16 mm</option><option value="18">18 mm</option></select></div>
            <div class="input-group"><label>Cantidad de Repisas:</label><input type="number" id="shelfQty" placeholder="Ej. 3"></div>
            <button class="btn" onclick="calcShelves()">Calcular Espacios</button>
            <div id="resShelves" class="cut-list">
                Debes dejar un hueco de: <br>
                <strong style="font-size:2rem; color:#333;" id="valShelfGap">0</strong> <span style="font-size:1.2rem; color:#555;">mm</span>
                <span class="note" style="display:block; margin-top:10px;">(Entre cada repisa)</span>
                <div style="text-align:center;"><button class="btn-save" onclick="saveProject('Repisas')">üíæ Guardar Medida</button></div>
            </div>
        </div>
    </main>

    <main id="view-material" class="view-section">
        <div class="card">
            <h2 class="section-title">ü™µ Calculadora de Hojas</h2>
            <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">Suma tus piezas para estimar material.</p>
            <div style="display:flex; gap:10px;">
                <div class="input-group" style="flex:1;"><label>Largo (mm)</label><input type="number" id="matL" placeholder="2400"></div>
                <div class="input-group" style="flex:1;"><label>Ancho (mm)</label><input type="number" id="matW" placeholder="600"></div>
            </div>
            <div class="input-group"><label>Cantidad</label><input type="number" id="matQ" value="1"></div>
            <button class="btn" onclick="addMaterialPiece()">‚ûï Agregar Pieza</button>
            <table class="mat-table"><thead><tr><th>Cant.</th><th>Medida</th><th>Area</th></tr></thead><tbody id="matListBody"></tbody></table>
            <div class="mat-summary" id="matResult" style="display:none;">
                <p>Area Total: <strong id="totalM2">0</strong> m¬≤</p>
                <div style="margin:15px 0; border-top:1px solid #ccc; padding-top:10px;">
                    <span style="font-size:0.9rem; color:#555;">Hojas (1.22x2.44) aprox:</span>
                    <span class="mat-big-num" id="totalSheets">0</span>
                </div>
                <div style="background:white; padding:10px; border-radius:5px; border:1px dashed var(--accent);">
                    <span style="color:#e65100;">üìè Cubre Canto:</span>
                    <strong id="totalEdge">0</strong> metros lineales
                </div>
                <button class="btn btn-outline" onclick="resetMaterial()">üóëÔ∏è Borrar Todo</button>
            </div>
        </div>
    </main>

    <main id="view-tips" class="view-section">
        <div style="margin-bottom:25px;">
            <h3 style="color:var(--primary); margin-bottom:10px; text-transform:uppercase; font-size:1rem;">üìè Medidas Est√°ndar</h3>
            <details class="accordion">
                <summary>Cocina üç≥</summary>
                <div class="accordion-content">
                    <div class="measure-item"><span>Altura Base:</span> <span class="measure-val">90 cm</span></div>
                    <div class="measure-item"><span>Profundidad Base:</span> <span class="measure-val">60 cm</span></div>
                    <div class="measure-item"><span>Distancia Barra/Alacena:</span> <span class="measure-val">55 - 60 cm</span></div>
                    <div class="measure-item"><span>Profundidad Alacena:</span> <span class="measure-val">30 - 35 cm</span></div>
                    <div class="pro-tip">‚ö†Ô∏è La altura incluye patas/zoclo (10-15cm) + mueble + cubierta.</div>
                </div>
            </details>
            <details class="accordion">
                <summary>Escritorio üñ•Ô∏è</summary>
                <div class="accordion-content">
                    <div class="measure-item"><span>Altura Total:</span> <span class="measure-val">75 cm</span></div>
                    <div class="measure-item"><span>Profundidad M√≠nima:</span> <span class="measure-val">50 cm</span></div>
                    <div class="measure-item"><span>Espacio piernas:</span> <span class="measure-val">60 cm (ancho)</span></div>
                    <div class="pro-tip">üí° Si usas bandeja para teclado, la cubierta puede ir a 78cm.</div>
                </div>
            </details>
            <details class="accordion">
                <summary>Closet / Ropero üëï</summary>
                <div class="accordion-content">
                    <div class="measure-item"><span>Profundidad (Ganchos):</span> <span class="measure-val">60 cm</span></div>
                    <div class="measure-item"><span>Altura Tubo (Largo):</span> <span class="measure-val">160 cm</span></div>
                    <div class="measure-item"><span>Altura Tubo (Camisas):</span> <span class="measure-val">100 cm</span></div>
                    <div class="pro-tip">üí° Si tienes menos de 55cm de fondo, los ganchos pegar√°n en las puertas.</div>
                </div>
            </details>
        </div>
        <div style="margin-bottom:15px;">
            <h3 style="color:var(--primary); margin-bottom:10px; text-transform:uppercase; font-size:1rem;">üìö Tips y Trucos</h3>
            <input type="text" id="searchInput" placeholder="üîç Buscar tip..." style="width:100%; padding:10px; border-radius:20px; border:1px solid #ccc;">
        </div>
        <div id="cardsContainer"></div>
    </main>

    <main id="view-tools" class="view-section">
        <div class="card">
            <h2 class="section-title">üî© Tornillos por Metro</h2>
            <div class="input-group"><label>Metros lineales a unir:</label><input type="number" id="screwMeters" placeholder="Ej. 3"></div>
            <button class="btn" onclick="calcScrews()">Calcular</button>
            <div id="resScrews" class="cut-list">
                Necesitas aprox: <br><strong style="font-size:2rem; color:#333;" id="valScrews">0</strong> <span style="font-size:1.2rem; color:#555;">Tornillos</span>
            </div>
        </div>
        <div class="card">
            <h2 class="section-title">üîÑ Convertidor Universal</h2>
            <div class="input-group"><label>Mil√≠metros (mm):</label><input type="number" id="inputMM" oninput="convertMM(this.value)" placeholder="Ej. 66"><div class="simple-result">= <span id="resCM">0</span> cm</div></div>
            <div style="margin: 25px 0; border-top: 1px solid #eee;"></div>
            <div class="input-group"><label>Pulgadas (inch):</label><input type="number" id="inputInch" oninput="convertInch(this.value)" placeholder="Ej. 7"><div class="simple-result">= <span id="resCMfromInch">0</span> cm</div></div>
        </div>
    </main>

    <main id="view-history" class="view-section">
        <div style="text-align:center; margin-bottom:20px;">
            <h2 style="color:var(--primary);">üìÅ Proyectos Guardados</h2>
            <p style="color:#777; font-size:0.9rem;">Tus c√°lculos se guardan aqu√≠.</p>
        </div>
        <div id="historyContainer">
            </div>
        <div id="emptyHistory" style="text-align:center; padding:40px; color:#aaa; display:none;">
            <span style="font-size:3rem; opacity:0.3;">üìÇ</span>
            <p>No tienes proyectos guardados.</p>
        </div>
    </main>

    <div id="projectModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="color:var(--primary); margin-bottom:5px;">T√≠tulo</h2>
            <p id="modalDate" style="color:#888; font-size:0.85rem; margin-bottom:20px;">Fecha</p>
            <div id="modalBody" style="background:#f5f5f5; padding:15px; border-radius:10px; font-size:0.95rem;">
                </div>
            <button class="btn" style="margin-top:20px;" onclick="closeModal()">Cerrar</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('view-cut', this)">
            <span class="nav-icon">üìê</span><span>Despiece</span>
        </div>
        <div class="nav-item" onclick="switchTab('view-material', this)">
            <span class="nav-icon">ü™µ</span><span>Material</span>
        </div>
        <div class="nav-item" onclick="switchTab('view-history', this)">
            <span class="nav-icon">üìÅ</span><span>Historial</span>
        </div>
        <div class="nav-item" onclick="switchTab('view-tips', this)">
            <span class="nav-icon">üìñ</span><span>Gu√≠a</span>
        </div>
        <div class="nav-item" onclick="switchTab('view-tools', this)">
            <span class="nav-icon">üß∞</span><span>Extras</span>
        </div>
    </nav>

    <script>
        // --- LOGICA MATERIALES ---
        let pieces = [];
        function addMaterialPiece() {
            let L = parseFloat(document.getElementById('matL').value);
            let W = parseFloat(document.getElementById('matW').value);
            let Q = parseFloat(document.getElementById('matQ').value);
            if(!L || !W || !Q) { alert("Llena todos los campos"); return; }
            pieces.push({l:L, w:W, q:Q});
            renderMaterialList();
            document.getElementById('matL').value = ''; document.getElementById('matW').value = ''; document.getElementById('matQ').value = '1'; document.getElementById('matL').focus();
        }
        function renderMaterialList() {
            let tbody = document.getElementById('matListBody');
            tbody.innerHTML = '';
            let totalAreaMM = 0; let totalPerimeterMM = 0;
            pieces.forEach((p) => {
                let area = (p.l * p.w * p.q);
                let perim = (2 * (p.l + p.w) * p.q);
                totalAreaMM += area; totalPerimeterMM += perim;
                tbody.innerHTML += `<tr><td>${p.q}</td><td>${p.l}x${p.w}</td><td>${(area/1000000).toFixed(2)}m¬≤</td></tr>`;
            });
            let totalM2 = totalAreaMM / 1000000;
            document.getElementById('totalM2').innerText = totalM2.toFixed(2);
            document.getElementById('totalSheets').innerText = Math.ceil((totalM2 / 2.9768) * 10) / 10;
            document.getElementById('totalEdge').innerText = Math.ceil(totalPerimeterMM / 1000);
            document.getElementById('matResult').style.display = pieces.length ? 'block' : 'none';
        }
        function resetMaterial() { if(confirm("¬øBorrar?")) { pieces = []; renderMaterialList(); } }

        // --- LOGICA DESPIECE ---
        function calcDrawer() {
            let hW = parseFloat(document.getElementById('drawerHoleW').value);
            let dep = parseFloat(document.getElementById('drawerDepth').value);
            let th = parseFloat(document.getElementById('drawerThickness').value);
            if(!hW || !dep) return;
            let slide = [250,300,350,400,450,500,550,600].reverse().find(s => s <= dep-10) || dep-20;
            let innerW = (hW - 26) - (2 * th);
            document.getElementById('valLat').innerText = `${slide} mm (Largo)`;
            document.getElementById('valFront').innerText = `${innerW} mm (Ancho)`;
            document.getElementById('valFloor').innerText = `${hW-28} x ${slide-2} mm`;
            document.getElementById('valSlide').innerText = `${slide} mm`;
            document.getElementById('resDrawer').style.display = 'block';
        }

        function calcDoor() {
            let h = parseFloat(document.getElementById('doorH').value);
            let w = parseFloat(document.getElementById('doorW').value);
            let g = parseFloat(document.getElementById('doorGap').value);
            if(h && w) {
                document.getElementById('valDoorDim').innerText = `${h-(g*2)} x ${w-(g*2)} mm`;
                document.getElementById('resDoor').style.display='block';
            }
        }

        function calcOverlayDoor() {
            let H = parseFloat(document.getElementById('ovH').value);
            let W = parseFloat(document.getElementById('ovW').value);
            let solape = parseFloat(document.getElementById('ovSolape').value);
            let qty = parseInt(document.getElementById('ovQty').value);
            if (!H || !W) { alert("Ingresa las medidas del hueco"); return; }
            let cutH = H + (solape * 2) - 4;
            let cutW = (qty === 1) ? W + (solape * 2) - 4 : (W + (solape * 2) - 4 - 3) / 2;
            document.getElementById('resOvH').innerText = cutH + " mm";
            document.getElementById('resOvW').innerText = cutW + " mm";
            document.getElementById('resOvQ').innerText = qty;
            document.getElementById('resOverlay').style.display = 'block';
        }

        function calcShelves() {
            let H = parseFloat(document.getElementById('shelfH').value);
            let th = parseFloat(document.getElementById('shelfThick').value);
            let qty = parseFloat(document.getElementById('shelfQty').value);
            if (!H || !qty) { alert("Ingresa datos"); return; }
            let totalThick = th * qty;
            let freeSpace = H - totalThick;
            if (freeSpace <= 0) { alert("Error: Demasiadas repisas"); return; }
            let gap = freeSpace / (qty + 1);
            document.getElementById('valShelfGap').innerText = gap.toFixed(1);
            document.getElementById('resShelves').style.display = 'block';
        }

        // --- SISTEMA DE GUARDADO ACTUALIZADO (DETALLES COMPLETOS) ---
        
        function saveProject(type) {
            let name = prompt("Agrega un nombre para guardar:", type);
            if (!name) return;

            let date = new Date().toLocaleDateString('es-ES', { day: 'numeric', month: 'short', hour:'2-digit', minute:'2-digit' });
            let inputsHTML = "";
            let resultHTML = "";

            // 1. CAJ√ìN
            if(type === 'Caj√≥n') {
                let hW = document.getElementById('drawerHoleW').value || 0;
                let dep = document.getElementById('drawerDepth').value || 0;
                let th = document.getElementById('drawerThickness').value;
                
                inputsHTML = `
                    <div style="background:#fff3e0; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9rem; border:1px solid #ffe0b2;">
                        <strong style="color:#e65100;">üì• Medidas Originales:</strong>
                        <ul style="margin:5px 0 0 20px; padding:0; color:#555;">
                            <li>Hueco Ancho: <b>${hW} mm</b></li>
                            <li>Profundidad Mueble: <b>${dep} mm</b></li>
                            <li>Grosor Material: <b>${th} mm</b></li>
                        </ul>
                    </div>
                `;
                resultHTML = document.getElementById('resDrawer').innerHTML;
            } 
            // 2. PUERTA INTERNA
            else if (type === 'Puerta Interna') {
                let h = document.getElementById('doorH').value || 0;
                let w = document.getElementById('doorW').value || 0;
                let gap = document.getElementById('doorGap').value;

                inputsHTML = `
                    <div style="background:#e0f2f1; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9rem; border:1px solid #b2dfdb;">
                        <strong style="color:#00695c;">üì• Medidas Originales:</strong>
                        <ul style="margin:5px 0 0 20px; padding:0; color:#555;">
                            <li>Alto Hueco: <b>${h} mm</b></li>
                            <li>Ancho Hueco: <b>${w} mm</b></li>
                            <li>Luz (Gap): <b>${gap} mm</b></li>
                        </ul>
                    </div>
                `;
                resultHTML = document.getElementById('resDoor').innerHTML;
            }
            // 3. PUERTA PARCHE
            else if (type === 'Puerta Parche') {
                let h = document.getElementById('ovH').value || 0;
                let w = document.getElementById('ovW').value || 0;
                let sol = document.getElementById('ovSolape').value;
                let qty = document.getElementById('ovQty').value;

                inputsHTML = `
                    <div style="background:#e8f5e9; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9rem; border:1px solid #c8e6c9;">
                        <strong style="color:#2e7d32;">üì• Medidas Originales:</strong>
                        <ul style="margin:5px 0 0 20px; padding:0; color:#555;">
                            <li>Alto Hueco: <b>${h} mm</b></li>
                            <li>Ancho Hueco: <b>${w} mm</b></li>
                            <li>Solape: <b>${sol} mm</b></li>
                            <li>Cantidad: <b>${qty} puerta(s)</b></li>
                        </ul>
                    </div>
                `;
                resultHTML = document.getElementById('resOverlay').innerHTML;
            }
            // 4. REPISAS
            else if (type === 'Repisas') {
                let h = document.getElementById('shelfH').value || 0;
                let th = document.getElementById('shelfThick').value;
                let qty = document.getElementById('shelfQty').value || 0;

                inputsHTML = `
                    <div style="background:#eceff1; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9rem; border:1px solid #cfd8dc;">
                        <strong style="color:#455a64;">üì• Medidas Originales:</strong>
                        <ul style="margin:5px 0 0 20px; padding:0; color:#555;">
                            <li>Altura Hueco: <b>${h} mm</b></li>
                            <li>Grosor Repisa: <b>${th} mm</b></li>
                            <li>Cantidad: <b>${qty} pzas</b></li>
                        </ul>
                    </div>
                `;
                resultHTML = document.getElementById('resShelves').innerHTML;
            }

            // Limpieza: Quitamos los botones de guardar clonados
            resultHTML = resultHTML.replace(/<div style="text-align:center;"><button.*?<\/button><\/div>/, '');
            resultHTML = resultHTML.replace(/<button.*?<\/button>/, ''); 

            const project = {
                id: Date.now(),
                name: name,
                type: type,
                date: date,
                content: inputsHTML + resultHTML // ¬°Ahora incluye los inputs!
            };

            let projects = JSON.parse(localStorage.getItem('carpentryProjects') || "[]");
            projects.unshift(project);
            localStorage.setItem('carpentryProjects', JSON.stringify(projects));
            
            alert("‚úÖ Guardado con detalles");
            loadHistory();
        }

        // --- FUNCIONES DE HISTORIAL ---
        function loadHistory() {
            let projects = JSON.parse(localStorage.getItem('carpentryProjects') || "[]");
            const container = document.getElementById('historyContainer');
            const empty = document.getElementById('emptyHistory');

            container.innerHTML = "";
            
            if (projects.length === 0) {
                empty.style.display = 'block';
                return;
            } else {
                empty.style.display = 'none';
            }

            projects.forEach(p => {
                let card = document.createElement('div');
                card.className = 'history-card';
                card.onclick = (e) => { 
                    if(!e.target.closest('.h-actions')) openModal(p.id); 
                };
                card.innerHTML = `
                    <div class="h-info">
                        <h3>${p.name}</h3>
                        <small>üìÖ ${p.date} ‚Ä¢ ${p.type}</small>
                    </div>
                    <div class="h-actions">
                        <button class="btn-icon" onclick="editProjectName(${p.id})">‚úèÔ∏è</button>
                        <button class="btn-icon" onclick="deleteProject(${p.id})" style="color:#d32f2f;">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function deleteProject(id) {
            if(!confirm("¬øBorrar este proyecto?")) return;
            let projects = JSON.parse(localStorage.getItem('carpentryProjects') || "[]");
            projects = projects.filter(p => p.id !== id);
            localStorage.setItem('carpentryProjects', JSON.stringify(projects));
            loadHistory();
        }

        function editProjectName(id) {
            let projects = JSON.parse(localStorage.getItem('carpentryProjects') || "[]");
            let project = projects.find(p => p.id === id);
            if(project) {
                let newName = prompt("Nuevo nombre:", project.name);
                if(newName) {
                    project.name = newName;
                    localStorage.setItem('carpentryProjects', JSON.stringify(projects));
                    loadHistory();
                }
            }
        }

        function openModal(id) {
            let projects = JSON.parse(localStorage.getItem('carpentryProjects') || "[]");
            let project = projects.find(p => p.id === id);
            if(project) {
                document.getElementById('modalTitle').innerText = project.name;
                document.getElementById('modalDate').innerText = `Guardado el ${project.date}`;
                document.getElementById('modalBody').innerHTML = project.content;
                document.getElementById('projectModal').style.display = 'flex';
            }
        }

        function closeModal() {
            document.getElementById('projectModal').style.display = 'none';
        }

        window.onclick = function(event) {
            let modal = document.getElementById('projectModal');
            if (event.target == modal) closeModal();
        }

        loadHistory();

        // --- LOGICA EXTRAS ---
        function calcScrews() {
            let m = parseFloat(document.getElementById('screwMeters').value);
            if(m) {
                document.getElementById('valScrews').innerText = Math.ceil((m/0.2)*1.1);
                document.getElementById('resScrews').style.display = 'block';
            }
        }
        function convertMM(val) { document.getElementById('resCM').innerText = val ? (val/10) : 0; }
        function convertInch(val) { document.getElementById('resCMfromInch').innerText = val ? (val*2.54).toFixed(2) : 0; }

        // --- LOGICA TIPS ---
        const tipsData = [
            { title: "Medidas de la Melamina", category: "Materiales", content: "Hoja est√°ndar: 1.22m x 2.44m (4x8 pies). Grosores comunes: 15mm y 18mm para estructura, 3mm-6mm para fondos de caj√≥n.", proTip: "Tip Pro: La hoja completa pesa aprox. 30kg (15mm). ¬°Pide ayuda para moverla!" },
            { title: "Resistol 850 (Pegamento)", category: "Adhesivos", content: "El pegamento blanco PVA (Resistol 850) NO adhiere sobre la cara de melamina plastificada. Solo funciona madera con madera o MDF crudo.", proTip: "Lija la superficie plastificada hasta quitar el color si necesitas pegar ah√≠, o usa pegamento de contacto." },
            { title: "Tornillos Adecuados", category: "Herramientas", content: "Usa tornillos Spax o 'negros' (fosfatados) de cuerda gruesa. Medida est√°ndar para armar cajas: 3.5 x 50mm (6x2 pulgadas).", proTip: "Para unir dos tableros de 15mm, el tornillo de 50mm es perfecto (entra 35mm en la segunda pieza)." },
            { title: "Correderas: La regla del 13", category: "Materiales", content: "Debes dejar EXACTAMENTE 13mm libres por cada lado del caj√≥n para la corredera telesc√≥pica est√°ndar.", proTip: "Si dejas 12mm entra forzado y se traba. Si dejas 14mm se cae el caj√≥n." },
            { title: "Pre-taladrado (Gu√≠a)", category: "T√©cnica", content: "La melamina se revienta f√°cil. Haz siempre una gu√≠a con broca de 3mm antes de meter el tornillo.", proTip: "Usa broca con avellanador para que la cabeza del tornillo quede al ras o hundida." },
            { title: "Cubre Cantos", category: "Materiales", content: "Protege los bordes cortados. El delgado (0.4mm) es est√©tico, el grueso (2mm) aguanta golpes (ideal para puertas).", proTip: "Corta los sobrantes del cubre canto deslizando una lima plana en un √°ngulo suave hacia abajo." }
        ];
        const tCont = document.getElementById('cardsContainer');
        const searchInput = document.getElementById('searchInput');
        function renderTips(list) {
            tCont.innerHTML = '';
            list.forEach(t => {
                tCont.innerHTML += `
                    <div class="tip-card">
                        <div class="tip-header"><span class="tip-tag">${t.category}</span></div>
                        <div class="tip-body">
                            <h3 class="tip-title">${t.title}</h3>
                            <p style="color:#555;font-size:0.95rem;">${t.content}</p>
                            <div class="pro-tip">üí° ${t.proTip}</div>
                        </div>
                    </div>`;
            });
        }
        renderTips(tipsData);
        searchInput.addEventListener('input', (e)=>{
            let term = e.target.value.toLowerCase();
            let filtered = tipsData.filter(t => t.title.toLowerCase().includes(term) || t.content.toLowerCase().includes(term));
            renderTips(filtered);
        });

        // --- NAVEGACION ---
        function switchTab(id, el) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
